<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Move file</title>
        <style type="text/css">
            * {
                font-family:Verdana, Arial, Helvetica, sans-serif;
            }
            html, body {
                overflow: hidden;
            }
            body {
                margin:18px;
                font-size:10px;
            }
            #dir {
                overflow:auto;
                overflow-y:scroll;
                padding:5px;
                background-color:Window;
                font-size:11px;
                border:2px inset;
                position:absolute;
                top:60px;
                left:19px;
                right:19px;
                bottom:51px;
            }
            #dir * {
                vertical-align:middle;
            }
            #dir div div {
                margin-left:8px
            }
            #dir a {
                white-space:nowrap;
                cursor:pointer;
            }
            #dir a:hover {
                text-decoration:underline;
            }
            #dir a:hover img {
                text-decoration:none;
            }
        </style>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/prototype/1.7.3.0/prototype.js"></script>
        <script type="text/javascript" src="javascript/javascript.js"></script>
        <script type="text/javascript" src="javascript/explorer.js"></script>
        <script type="text/javascript">
            var global_dir = '';

            function movefile(dir)
            {
                global_dir = dir;
                //TODO issues with ie
                window.opener.document.getElementById('loading').style.display = '';
                window.opener.x_renamefile({{id}}, {{path|json_encode()|raw}}, dir, '', 0, movefile_r);
            }

            //TODO Closes on mouse out???
            function movefile_r(data)
            {
                window.opener.document.getElementById('loading').style.display = 'none';

                if (data['path'] == {{path|json_encode()|raw}})
                    return;

                if (data['error']) {
                    alert(data['error']);
                    //Somthing prevents the FF from closing when hovering the link so we remove it
                    document.body.innerHTML = '';
                    window.close();
                } else if (data['yesno']) {
                    if (eval(confirm(data['yesno']))==true){
                        document.getElementById('loading').style.display = '';
                        window.opener.x_renamefile({{id}}, {{path|json_encode()|raw}}, global_dir, '', 1, movefile_r);
                    } else {
                        //Somthing prevents the FF from closing when hovering the link so we remove it
                        document.body.innerHTML = '';
                        window.close();
                    }
                } else {
                    window.opener.document.getElementById('files').removeChild(window.opener.document.getElementById('tilebox'+data['id']));
                    //Somthing prevents FF from closing when hovering the link so we remove it
                    document.body.innerHTML = '';
                    window.close();
                }
            }
        </script>
    </head>
    <body style="background-color:ThreeDFace; border:0px #FF0000 none;">
        <p>Click on the folder where you want to move the file '{{filename}}'.</p>
        <img id="loading" style="float:right; cursor:default; display:none; padding:4px" src="/theme/default/images/admin/loading.gif" width="16" height="16" alt="Loading" />
        <div id="dir">
            {% include 'admin/partial-listDirs.html' with {'move': true} %}
        </div>
        <p style="bottom:18px; position:absolute;">Click the plus sign above to see the subfolders.</p>
    </body>
</html>
